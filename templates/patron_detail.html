{% extends "base.html" %}

{% block title %}{{ patron.first_name }} {{ patron.last_name }} - UniLibPlus{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ patron.first_name }} {{ patron.last_name }}</h1>
    <p>Patron Details</p>
</div>

<div class="card">
    <div class="card-header">
        <h2>Basic Information</h2>
    </div>
    <table>
        <tr>
            <th style="width: 150px;">Patron ID</th>
            <td>{{ patron.patron_id }}</td>
        </tr>
        <tr>
            <th>Name</th>
            <td><strong>{{ patron.first_name }} {{ patron.last_name }}</strong></td>
        </tr>
        <tr>
            <th>Email</th>
            <td>{{ patron.email or 'N/A' }}</td>
        </tr>
        <tr>
            <th>Type</th>
            <td><span class="badge badge-info">{{ patron.patron_type }}</span></td>
        </tr>
        <tr>
            <th>Balance</th>
            <td>${{ "%.2f"|format(patron.balance) }}</td>
        </tr>
        <tr>
            <th>Total Fines</th>
            <td>${{ "%.2f"|format(patron.total_fines or 0) }}</td>
        </tr>
        <tr>
            <th>Unpaid Fines</th>
            <td>
                {% if patron.unpaid_fines and patron.unpaid_fines > 0 %}
                    <span class="badge badge-danger">${{ "%.2f"|format(patron.unpaid_fines) }}</span>
                {% else %}
                    <span class="badge badge-success">$0.00</span>
                {% endif %}
            </td>
        </tr>
    </table>
</div>

<div class="card">
    <div class="card-header">
        <h2>Loan History</h2>
    </div>
    {% if loans %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Loan ID</th>
                    <th>Barcode</th>
                    <th>ISBN</th>
                    <th>Title</th>
                    <th>Loan Date</th>
                    <th>Due Date</th>
                    <th>Return Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for loan in loans %}
                <tr>
                    <td>{{ loan.loan_id }}</td>
                    <td>{{ loan.barcode }}</td>
                    <td>{{ loan.isbn }}</td>
                    <td>{{ loan.title }}</td>
                    <td>{{ loan.loan_ts | dateformat }}</td>
                    <td>{{ loan.due_ts | dateformat }}</td>
                    <td>{{ loan.return_ts | dateformat if loan.return_ts else '-' }}</td>
                    <td>
                        {% if loan.loan_status == 'Returned' %}
                            <span class="badge badge-success">Returned</span>
                        {% elif loan.loan_status == 'Overdue' %}
                            <span class="badge badge-danger">Overdue</span>
                        {% elif loan.loan_status == 'On loan' %}
                            <span class="badge badge-warning">On Loan</span>
                        {% else %}
                            <span class="badge badge-info">{{ loan.loan_status }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <p>ðŸ“š No loan records found</p>
    </div>
    {% endif %}
</div>

<div class="mt-2">
    <a href="{{ url_for('patrons') }}" class="btn btn-secondary">Back to Patrons</a>
</div>
{% endblock %}

